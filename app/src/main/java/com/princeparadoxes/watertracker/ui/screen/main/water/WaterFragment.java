package com.princeparadoxes.watertracker.ui.screen.main.water;

import android.opengl.GLSurfaceView;
import android.os.Bundle;
import android.support.annotation.Nullable;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.princeparadoxes.watertracker.ProjectApplication;
import com.princeparadoxes.watertracker.R;
import com.princeparadoxes.watertracker.base.BaseFragment;

import butterknife.BindView;
import io.reactivex.disposables.CompositeDisposable;

public class WaterFragment extends BaseFragment {

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////  VIEWS  //////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

//    @BindView(R.id.water_gl_view)
    GLSurfaceView mGLSurfaceView;

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////  FIELDS  /////////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    private CompositeDisposable mDisposable;
    private WaterRenderer mWaterRenderer;

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////  INIT SCREEN  /////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        ProjectApplication app = ProjectApplication.get(getActivity());
        WaterScope.Component component = DaggerWaterScope_Component.builder()
                .projectComponent(app.component())
                .build();
        component.inject(this);
    }

    @Nullable
    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {
        ViewGroup view = (ViewGroup) super.onCreateView(inflater, container, savedInstanceState);
        mGLSurfaceView = new GLSurfaceView(getContext());
        view.addView(mGLSurfaceView);
        return view;
    }

    @Override
    protected int layoutId() {
        return R.layout.fragment_water;
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ///////////////////////////////////  START SCREEN  ////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    @Override
    public void onStart() {
        super.onStart();
        mDisposable = new CompositeDisposable();
//        if (mWaterRenderer == null) mWaterRenderer = new WaterRenderer(getActivity());
        mWaterRenderer = new WaterRenderer(getActivity());
        initGlSurfaceViewIfNeeded();
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////  GL SURFACE VIEW  ////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    private void initGlSurfaceViewIfNeeded() {
        mGLSurfaceView.setEGLContextClientVersion(2);
        mGLSurfaceView.setEGLConfigChooser(8, 8, 8, 8, 8, 0);
        mGLSurfaceView.setRenderer(mWaterRenderer);
        mGLSurfaceView.setRenderMode(GLSurfaceView.RENDERMODE_CONTINUOUSLY);
    }

    @Override
    public void onResume() {
        super.onResume();
        mGLSurfaceView.onResume();
    }

    @Override
    public void onPause() {
        super.onPause();
        mGLSurfaceView.onPause();
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////  STOP SCREEN  ////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    @Override
    public void onStop() {
        mDisposable.dispose();
        super.onStop();
    }

    ///////////////////////////////////////////////////////////////////////////////////////////////
    /////////////////////////////////////  NAVIGATION  ////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    ///////////////////////////////////////////////////////////////////////////////////////////////
    ////////////////////////////////////  INSTANCE  ///////////////////////////////////////////////
    ///////////////////////////////////////////////////////////////////////////////////////////////

    public static WaterFragment newInstance() {
        Bundle args = new Bundle();
        WaterFragment fragment = new WaterFragment();
        fragment.setArguments(args);
        return fragment;
    }

}
